-- Fix Quest 27939 "The Desert Fox" 

-- Desert Fox SAI
UPDATE `creature_template` SET `AIName`="SmartAI" WHERE `entry` IN (47201);
DELETE FROM `smart_scripts` WHERE `entryorguid` IN (47201) AND `source_type`=0;
INSERT INTO `smart_scripts` (`entryorguid`,`source_type`,`id`,`link`,`event_type`,`event_phase_mask`,`event_chance`,`event_flags`,`event_param1`,`event_param2`,`event_param3`,`event_param4`,`event_param5`,`action_type`,`action_param1`,`action_param2`,`action_param3`,`action_param4`,`action_param5`,`action_param6`,`target_type`,`target_param1`,`target_param2`,`target_param3`,`target_x`,`target_y`,`target_z`,`target_o`,`comment`) VALUES
(47201,0,0,1,73,0,100,0,87961,0,2000,2000,0,85,87963,0,0,0,0,0,7,0,0,0,0,0,0,0,"Desert Fox - On Spellclick - Self Cast 'Create Fox'"),
(47201,0,1,0,61,0,100,0,0,0,0,0,0,41,1000,0,0,0,0,0,1,0,0,0,0,0,0,0,"Desert Fox - On Spellclick - Despawn");

-- Fix Desert Fox
UPDATE `creature_template` SET `npcflag`=16777216 WHERE `entry`=47201;

-- Quest "The Desert Fox" requires "Eastern Hospitality"
DELETE FROM `quest_template_addon` WHERE `ID` IN (27939);
INSERT INTO `quest_template_addon` (`ID`,`PrevQuestID`,`ProvidedItemCount`) VALUES  (27939,27926,0);

-- Add quest reward text
DELETE FROM `quest_offer_reward` WHERE `ID`=27939;
INSERT INTO `quest_offer_reward` (`ID`, `Emote1`,`Emote2`,`RewardText`) VALUES
(27939, 396, 6, 'You''ve done it!$b$bPerhaps I can trust you vizh more serious matters, hmm?');

-- Add Spell click to Desert Fox
DELETE FROM `npc_spellclick_spells` WHERE `npc_entry`=47201;
INSERT INTO `npc_spellclick_spells` (`npc_entry`,`spell_id`,`cast_flags`,`user_type`) VALUES (47201,87961,1,0);

-- Pathing for Desert Fox Entry: 47201 'TDB FORMAT' 
SET @NPC := 266473;
SET @PATH := @NPC * 10;
UPDATE `creature` SET `spawndist`=0,`MovementType`=2,`position_x`=-10801.8,`position_y`=-154.148,`position_z`=22.32883, `orientation`=0 WHERE `guid`=@NPC;
DELETE FROM `creature_template_addon` WHERE `entry`=47201;
INSERT INTO `creature_template_addon` (`entry`,`path_id`,`mount`,`bytes1`,`bytes2`,`emote`,`auras`) VALUES (47201,@PATH,0,0,1,0, '81509');
DELETE FROM `waypoint_data` WHERE `id`=@PATH;
INSERT INTO `waypoint_data` (`id`,`point`,`position_x`,`position_y`,`position_z`,`orientation`,`delay`,`move_type`,`action`,`action_chance`,`wpguid`) VALUES
(@PATH,1,-10809.3,-74.46094,21.06117,0,0,1,0,100,0),
(@PATH,2,-10806.4,-123.904,17.56047,0,0,1,0,100,0),
(@PATH,3,-10820.11,-142.9904,19.99105,0,0,1,0,100,0),
(@PATH,4,-10819.9,-137.9221,19.12508,0,0,1,0,100,0),
(@PATH,5,-10807.54,-124.7167,17.3842,0,0,1,0,100,0),
(@PATH,6,-10810.21,-94.2989,18.39466,0,0,1,0,100,0),
(@PATH,7,-10811.26,-143.2076,20.26863,0,0,1,0,100,0),
(@PATH,8,-10817.71,-142.709,20.08651,0,0,1,0,100,0),
(@PATH,9,-10795.57,-121.6665,18.249,0,0,1,0,100,0),
(@PATH,10,-10819.31,-141.548,19.82235,0,0,1,0,100,0),
(@PATH,11,-10806.53,-107.4967,17.23283,0,0,1,0,100,0),
(@PATH,12,-10809.25,-141.3633,19.89901,0,0,1,0,100,0),
(@PATH,13,-10801.8,-154.148,22.33431,0,0,1,0,100,0),
(@PATH,14,-10808.05,-76.89342,20.6183,0,0,1,0,100,0),
(@PATH,15,-10807.19,-71.77058,21.71107,0,0,1,0,100,0),
(@PATH,16,-10813.22,-153.6202,21.62215,0,0,1,0,100,0),
(@PATH,17,-10807.46,-59.07773,23.5092,0,0,1,0,100,0),
(@PATH,18,-10809.12,-57.75418,23.4882,0,0,1,0,100,0),
(@PATH,19,-10808.93,-140.2613,19.6678,0,0,1,0,100,0),
(@PATH,20,-10825,-75,20.93617,0,0,1,0,100,0),
(@PATH,21,-10805.98,-125.2435,17.85246,0,0,1,0,100,0),
(@PATH,22,-10808.55,-76.47772,20.74232,0,0,1,0,100,0),
(@PATH,23,-10806.1,-94.79736,18.88978,0,0,1,0,100,0),
(@PATH,24,-10806.63,-90.60937,19.39271,0,0,1,0,100,0),
(@PATH,25,-10808.26,-92.73988,18.99964,0,0,1,0,100,0),
(@PATH,26,-10805.22,-105.6852,17.47721,0,0,1,0,100,0),
(@PATH,27,-10809.96,-77.53008,20.32118,0,0,1,0,100,0),
(@PATH,28,-10809.43,-124.9828,17.40739,0,0,1,0,100,0),
(@PATH,29,-10807.25,-109.2464,17.0612,0,0,1,0,100,0),
(@PATH,30,-10810.95,-122.6405,17.04073,0,0,1,0,100,0),
(@PATH,31,-10795.19,-121.3749,18.06882,0,0,1,0,100,0),
(@PATH,32,-10810.11,-88.9187,19.0785,0,0,1,0,100,0),
(@PATH,33,-10809.63,-93.77502,18.52796,0,0,1,0,100,0),
(@PATH,34,-10812.5,-154.166,21.52401,0,0,1,0,100,0),
(@PATH,35,-10810.53,-90.86164,18.89369,0,0,1,0,100,0),
(@PATH,36,-10809.85,-76.33961,20.59339,0,0,1,0,100,0),
(@PATH,37,-10811,-125.3398,17.29069,0,0,1,0,100,0),
(@PATH,38,-10807.41,-88.67823,19.53065,0,0,1,0,100,0),
(@PATH,39,-10795.92,-122.189,18.39963,0,0,1,0,100,0),
(@PATH,40,-10802.08,-160.416,23.08651,0,0,1,0,100,0),
(@PATH,41,-10803.09,-154.498,22.39901,0,0,1,0,100,0),
(@PATH,42,-10795.23,-120.3448,17.93772,0,0,1,0,100,0),
(@PATH,43,-10819.51,-105.602,16.91569,0,0,1,0,100,0),
(@PATH,44,-10807.97,-74.71667,21.25404,0,0,1,0,100,0),
(@PATH,45,-10808.1,-109.7168,16.91569,0,0,1,0,100,0),
(@PATH,46,-10817.71,-142.709,20.08651,0,0,1,0,100,0),
(@PATH,47,-10806.44,-159.7172,22.77401,0,0,1,0,100,0),
(@PATH,48,-10807.5,-73.2598,21.47865,0,0,1,0,100,0),
(@PATH,49,-10805.02,-126.5115,18.12004,0,0,1,0,100,0),
(@PATH,50,-10806.4,-138.4414,19.39901,0,0,1,0,100,0),
(@PATH,51,-10811.22,-90.73469,18.8263,0,0,1,0,100,0),
(@PATH,52,-10808.33,-106.4231,17.10368,0,0,1,0,100,0),
(@PATH,53,-10806.05,-143.9167,20.40071,0,0,1,0,100,0),
(@PATH,54,-10809.47,-75.20032,20.77503,0,0,1,0,100,0),
(@PATH,55,-10820.13,-86.97457,18.93714,0,0,1,0,100,0),
(@PATH,56,-10807.96,-91.7659,19.09339,0,0,1,0,100,0),
(@PATH,57,-10808.99,-75.54745,20.79164,0,0,1,0,100,0),
(@PATH,58,-10805.14,-90.42341,19.59315,0,0,1,0,100,0),
(@PATH,59,-10807.83,-124.1502,17.41569,0,0,1,0,100,0),
(@PATH,60,-10807.55,-138.6923,19.60457,0,0,1,0,100,0),
(@PATH,61,-10812.43,-154.2785,21.54549,0,0,1,0,100,0),
(@PATH,62,-10807.55,-107.122,17.19767,0,0,1,0,100,0),
(@PATH,63,-10801.45,-160.6589,23.01082,0,0,1,0,100,0),
(@PATH,64,-10807.74,-110.483,16.92375,0,0,1,0,100,0),
(@PATH,65,-10809.81,-126.3574,17.54069,0,0,1,0,100,0),
(@PATH,66,-10807.48,-140.5903,19.83236,0,0,1,0,100,0),
(@PATH,67,-10802.17,-160.873,23.02401,0,0,1,0,100,0),
(@PATH,68,-10806.16,-159.8802,22.77409,0,0,1,0,100,0),
(@PATH,69,-10821.4,-104.7474,17.04075,0,0,1,0,100,0),
(@PATH,70,-10805.12,-126.5266,18.10978,0,0,1,0,100,0),
(@PATH,71,-10809.12,-125.1293,17.46208,0,0,1,0,100,0),
(@PATH,72,-10806.52,-160.0605,22.77401,0,0,1,0,100,0),
(@PATH,73,-10806.88,-140.2394,19.91536,0,0,1,0,100,0),
(@PATH,74,-10824.99,-75.09921,20.80067,0,0,1,0,100,0),
(@PATH,75,-10807.51,-128.1602,17.92961,0,0,1,0,100,0),
(@PATH,76,-10819.54,-86.36687,19.08314,0,0,1,0,100,0),
(@PATH,77,-10805.91,-161.2081,22.90999,0,0,1,0,100,0),
(@PATH,78,-10812.48,-125.0392,17.33858,0,0,1,0,100,0);
